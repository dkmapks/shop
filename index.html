<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Symulator handlu</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; padding: 20px; }
  input, button { padding: 5px; margin: 5px; }
  .vip { color: gold; font-weight: bold; }
  #log { background: #333; height: 150px; overflow-y: auto; padding: 10px; margin-top: 10px; }
</style>
</head>
<body>

<h1>Symulator handlu</h1>

<p>Gotówka: <span id="money">2500</span> zł</p>
<p>Towar: <span id="stock">0</span> g</p>
<p>Dług do spłaty: <span id="debt">0</span> zł</p>

<h3>Pożycz pieniądze (oddajesz 3x więcej!)</h3>
<input type="number" id="loanAmount" placeholder="Kwota do pożyczenia" />
<button onclick="takeLoan()">Pożycz</button>

<h3>Ręczny zakup</h3>
<input type="number" id="buyAmount" placeholder="Ilość gram" />
<input type="number" id="buyPrice" placeholder="Cena za gram" />
<button onclick="manualBuy()">Kup</button>

<h3>Ręczna sprzedaż</h3>
<input type="number" id="sellAmount" placeholder="Ilość gram" />
<input type="number" id="sellPrice" placeholder="Cena za gram" />
<button onclick="manualSell()">Sprzedaj</button>

<h3>Rzucanie towarem (50% szans na sprzedaż)</h3>
<input type="number" id="throwAmount" placeholder="Ilość gram" />
<input type="number" id="throwPrice" placeholder="Cena za gram" />
<button onclick="throwStock()">Rzuć towar</button>

<h3>Słupy - ich ceny do oddania</h3>
<ul id="slupyList"></ul>

<h3>Losowi klienci</h3>
<button onclick="showClients()">Pokaż klientów</button>
<ul id="clientsList"></ul>

<h3>Oferta hurtowni (co 30 sekund)</h3>
<p id="hurtowniaOffer">Brak oferty</p>
<button onclick="buyFromHurtownia()">Kup hurtowo</button>

<h3>Log</h3>
<div id="log"></div>

<script>
let playerMoney = 2500;
let playerStock = 0;
let debt = 0;

let slupy = [
  { name: 'Słup1', pricePerGram: 30 },
  { name: 'Słup2', pricePerGram: 28 },
];

let currentHurtOffer = null;

function log(msg) {
  const logDiv = document.getElementById('log');
  logDiv.innerHTML = msg + '<br>' + logDiv.innerHTML;
}

function updateUI() {
  document.getElementById('money').innerText = playerMoney.toFixed(2);
  document.getElementById('stock').innerText = playerStock.toFixed(2);
  document.getElementById('debt').innerText = debt.toFixed(2);

  // Aktualizacja słupów
  let slupyList = document.getElementById('slupyList');
  slupyList.innerHTML = '';
  slupyOffers().forEach(s => {
    let li = document.createElement('li');
    li.innerText = `${s.name} proponuje oddać ${s.price} zł/g`;
    slupyList.appendChild(li);
  });
}

function takeLoan() {
  let amount = parseFloat(document.getElementById('loanAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert('Wpisz poprawną kwotę');
    return;
  }
  playerMoney += amount;
  debt += amount * 3;
  log(`Pożyczono ${amount.toFixed(2)} zł. Do oddania: ${debt.toFixed(2)} zł`);
  updateUI();
}

function manualBuy() {
  let amount = parseFloat(document.getElementById('buyAmount').value);
  let price = parseFloat(document.getElementById('buyPrice').value);
  if (isNaN(amount) || amount <= 0 || isNaN(price) || price <= 0) {
    alert('Wpisz poprawne dane');
    return;
  }
  let total = amount * price;
  if (total > playerMoney) {
    alert('Nie masz tyle pieniędzy');
    return;
  }
  playerStock += amount;
  playerMoney -= total;
  log(`Kupiono ${amount.toFixed(2)} g po ${price.toFixed(2)} zł/g (wydano ${total.toFixed(2)} zł)`);
  updateUI();
}

function manualSell() {
  let amount = parseFloat(document.getElementById('sellAmount').value);
  let price = parseFloat(document.getElementById('sellPrice').value);
  if (isNaN(amount) || amount <= 0 || isNaN(price) || price <= 0) {
    alert('Wpisz poprawne dane');
    return;
  }
  if (amount > playerStock) {
    alert('Nie masz tyle towaru');
    return;
  }
  let total = amount * price;
  playerStock -= amount;
  playerMoney += total;
  log(`Sprzedano ${amount.toFixed(2)} g po ${price.toFixed(2)} zł/g (zarobiono ${total.toFixed(2)} zł)`);
  updateUI();
}

function throwStock() {
  let amount = parseFloat(document.getElementById('throwAmount').value);
  let price = parseFloat(document.getElementById('throwPrice').value);
  if (isNaN(amount) || amount <= 0 || isNaN(price) || price <= 0) {
    alert('Wpisz poprawne dane');
    return;
  }
  if (amount > playerStock) {
    alert('Nie masz tyle towaru');
    return;
  }
  if (Math.random() < 0.5) {
    let total = amount * price;
    playerStock -= amount;
    playerMoney += total;
    log(`Rzucono ${amount.toFixed(2)} g po ${price.toFixed(2)} zł/g i sprzedano za ${total.toFixed(2)} zł`);
  } else {
    log('Nikt nie kupił rzuconego towaru.');
  }
  updateUI();
}

function slupyOffers() {
  return slupy.map(s => {
    let offer = s.pricePerGram + (Math.random() * 4 - 2);
    offer = Math.max(5, Math.round(offer));
    return { name: s.name, price: offer };
  });
}

function randomClients() {
  let clients = [];
  let clientCount = Math.floor(Math.random() * 5) + 1;
  for (let i = 0; i < clientCount; i++) {
    let amount = Math.floor(Math.random() * 50) + 1;
    let price = Math.floor(Math.random() * 26) + 25;
    clients.push({ amount, price, vip: false });
  }
  if (Math.random() < 0.2) {
    clients.push({
      amount: Math.floor(Math.random() * 101) + 200,
      price: Math.floor(Math.random() * 11) + 30,
      vip: true,
    });
  }
  return clients;
}

function showClients() {
  let clientsList = document.getElementById('clientsList');
  clientsList.innerHTML = '';
  let clients = randomClients();
  clients.forEach((c, i) => {
    let li = document.createElement('li');
    li.innerHTML = `Klient ${i + 1}: ${c.amount} g, cena ${c.price} zł/g` + (c.vip ? ' <span class="vip">VIP</span>' : '');
    clientsList.appendChild(li);
  });
  log(`Wygenerowano ${clients.length} klientów`);
}

function hurtowniaOffer() {
  let amount = Math.floor(Math.random() * 4901) + 100;
  let price = Math.floor(Math.random() * 8) + 7;
  currentHurtOffer = { amount, price };
  document.getElementById('hurtowniaOffer').innerText = `Hurtownia oferuje ${amount} g po ${price} zł/g`;
  log(`Nowa oferta hurtowni: ${amount} g po ${price} zł/g`);
}

function buyFromHurtownia() {
  if (!currentHurtOffer) {
    alert('Brak oferty hurtowni');
    return;
  }
  let total = currentHurtOffer.amount * currentHurtOffer.price;
  if (playerMoney < total) {
    alert('Nie masz tyle pieniędzy!');
    return;
  }
  playerStock += currentHurtOffer.amount;
  playerMoney -= total;
  log(`Kupiono od hurtowni ${currentHurtOffer.amount} g po ${currentHurtOffer.price} zł/g (wydano ${total.toFixed(2)} zł)`);
  currentHurtOffer = null;
  document.getElementById('hurtowniaOffer').innerText = 'Brak oferty';
  updateUI();
}

// Oferta hurtowni co 30 sekund
setInterval(hurtowniaOffer, 30000);

// Aktualizacja UI co sekundę (ceny słupów)
setInterval(updateUI, 1000);

updateUI();
</script>

</body>
</html>